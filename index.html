<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Carta de amor interactiva para San Valent√≠n">
<meta name="theme-color" content="#ff4d6d">
<title>Carta de Amor para Yin üíñ</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary-color: #ff4d6d;
  --primary-dark: #c9184a;
  --secondary-color: #764ba2;
  --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  --gradient-primary: linear-gradient(145deg, #ff4d6d, #c9184a);
  --shadow-main: 0 30px 60px rgba(0,0,0,0.3);
  --transition-smooth: cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

html, body {
  width: 100%;
  height: 100%;
  overflow-x: hidden;
}

body {
  min-height: 100vh;
  background: var(--gradient-bg);
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  position: relative;
  padding: 20px 10px;
}

/* ========================
   EFECTOS DE FONDO
======================== */

.particles-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 0;
}

.floating-heart {
  position: absolute;
  font-size: 20px;
  opacity: 0;
  animation: float-up 10s infinite ease-in;
  will-change: transform, opacity;
}

@keyframes float-up {
  0% {
    transform: translateY(110vh) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 0.7;
  }
  90% {
    opacity: 0.7;
  }
  100% {
    transform: translateY(-20vh) rotate(360deg);
    opacity: 0;
  }
}

.stars-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}

.star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: white;
  border-radius: 50%;
  animation: twinkle 3s infinite;
  will-change: opacity;
}

@keyframes twinkle {
  0%, 100% { 
    opacity: 0.2;
  }
  50% { 
    opacity: 1;
  }
}

/* ========================
   SOBRE Y CARTA
======================== */

.envelope-wrapper {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 450px;
  margin: 0 auto;
}

.tap-instruction {
  position: absolute;
  top: -70px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  font-size: 1.1em;
  font-weight: 700;
  text-shadow: 0 3px 10px rgba(0,0,0,0.5);
  animation: bounce-instruction 2s infinite;
  pointer-events: none;
  white-space: nowrap;
  opacity: 1;
  transition: opacity 0.5s ease;
  z-index: 5;
}

@keyframes bounce-instruction {
  0%, 100% { 
    transform: translateX(-50%) translateY(0); 
  }
  50% { 
    transform: translateX(-50%) translateY(-12px); 
  }
}

.tap-instruction.hidden {
  opacity: 0;
  visibility: hidden;
}

.envelope {
  width: 100%;
  max-width: 450px;
  height: 300px;
  background: linear-gradient(145deg, #ffffff, #f5f5f5);
  border-radius: 20px;
  position: relative;
  cursor: pointer;
  box-shadow: 
    var(--shadow-main),
    0 0 60px rgba(255,77,109,0.3),
    inset 0 2px 0 rgba(255,255,255,0.9);
  overflow: visible;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
  margin: 0 auto;
}

.envelope::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent 48%, rgba(255,77,109,0.12) 50%, transparent 52%);
  animation: shine 5s infinite;
  pointer-events: none;
  border-radius: 20px;
}

@keyframes shine {
  0% { transform: translateX(-150%) translateY(-150%); }
  100% { transform: translateX(150%) translateY(150%); }
}

.envelope:hover:not(.open) {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 
    0 40px 80px rgba(0,0,0,0.35),
    0 0 80px rgba(255,77,109,0.4);
}

/* Sello postal */
.stamp {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 55px;
  height: 55px;
  background: var(--gradient-primary);
  border: 2px dashed rgba(255,255,255,0.9);
  border-radius: 6px;
  z-index: 5;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8em;
  transform: rotate(12deg);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Lazo decorativo */
.ribbon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80px;
  height: 80px;
  z-index: 6;
  pointer-events: none;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.25));
  transition: all 1s ease;
}

.ribbon-left,
.ribbon-right {
  position: absolute;
  width: 40px;
  height: 25px;
  background: var(--primary-color);
  border-radius: 50%;
}

.ribbon-left {
  top: 15px;
  left: -5px;
  transform: rotate(-20deg);
}

.ribbon-right {
  top: 15px;
  right: -5px;
  transform: rotate(20deg);
}

.ribbon-center {
  position: absolute;
  width: 20px;
  height: 20px;
  background: var(--primary-dark);
  border-radius: 50%;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  z-index: 1;
}

.ribbon-tail-left,
.ribbon-tail-right {
  position: absolute;
  width: 15px;
  height: 35px;
  background: var(--primary-color);
  top: 35px;
}

.ribbon-tail-left {
  left: 20px;
  transform: rotate(-15deg);
  clip-path: polygon(0 0, 100% 0, 50% 100%);
}

.ribbon-tail-right {
  right: 20px;
  transform: rotate(15deg);
  clip-path: polygon(0 0, 100% 0, 50% 100%);
}

/* Tapa del sobre */
.flap {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gradient-primary);
  clip-path: polygon(0 0, 100% 0, 50% 65%);
  z-index: 4;
  transform-origin: top;
  transition: transform 1.3s var(--transition-smooth);
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
  border-radius: 20px 20px 0 0;
}

.flap::after {
  content: 'üíå';
  position: absolute;
  top: 42%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 3em;
  animation: pulse-icon 2.5s infinite;
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.2));
}

@keyframes pulse-icon {
  0%, 100% { 
    transform: translate(-50%, -50%) scale(1); 
  }
  50% { 
    transform: translate(-50%, -50%) scale(1.15); 
  }
}

/* Papel de la carta */
.paper {
  position: absolute;
  bottom: -100%;
  left: 3%;
  width: 94%;
  height: 85%;
  background: linear-gradient(to bottom, #fffef9, #fff9ed);
  border-radius: 20px;
  padding: 30px 25px;
  box-sizing: border-box;
  box-shadow: 
    0 20px 60px rgba(0,0,0,0.35),
    inset 0 2px 0 rgba(255,255,255,0.9);
  transition: bottom 1.5s var(--transition-smooth), 
              opacity 0.9s ease;
  z-index: 3;
  overflow-y: auto;
  overflow-x: hidden;
  opacity: 0;
  pointer-events: none;
  border: 2px solid rgba(255,77,109,0.15);
}

/* Scrollbar personalizada */
.paper::-webkit-scrollbar {
  width: 8px;
}

.paper::-webkit-scrollbar-track {
  background: rgba(255,77,109,0.08);
  border-radius: 10px;
  margin: 8px 0;
}

.paper::-webkit-scrollbar-thumb {
  background: var(--gradient-primary);
  border-radius: 10px;
  border: 2px solid #fff9ed;
}

.paper::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(145deg, #c9184a, #ff4d6d);
}

/* Estados del sobre abierto */
.envelope.open .flap {
  transform: rotateX(180deg);
}

.envelope.open .paper {
  bottom: 8%;
  opacity: 1;
  pointer-events: auto;
}

.envelope.open .ribbon {
  opacity: 0;
  transform: translate(-50%, -50%) scale(0) rotate(360deg);
}

.envelope.open .stamp {
  animation: stamp-bounce 0.6s ease;
}

@keyframes stamp-bounce {
  0%, 100% { transform: rotate(12deg) scale(1); }
  50% { transform: rotate(12deg) scale(1.15); }
}

/* ========================
   CONTENIDO DE LA CARTA
======================== */

.heart-header {
  font-size: 4em;
  text-align: center;
  margin-bottom: 15px;
  animation: heartbeat 1.8s infinite;
  filter: drop-shadow(0 4px 8px rgba(255,77,109,0.3));
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  10% { transform: scale(1.12); }
  20% { transform: scale(1); }
  30% { transform: scale(1.06); }
  40% { transform: scale(1); }
}

h1 {
  text-align: center;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-size: 2.2em;
  margin-bottom: 20px;
  font-weight: 800;
  letter-spacing: 0.5px;
  line-height: 1.2;
}

.divider {
  width: 65%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
  margin: 20px auto;
  border-radius: 2px;
}

.poem {
  color: #333;
  line-height: 1.8;
  text-align: center;
  font-size: 1em;
  margin-bottom: 25px;
  font-style: italic;
  font-weight: 400;
}

.poem br {
  display: block;
  content: "";
  margin-top: 8px;
}

.question {
  margin: 25px 0 20px;
  font-size: 1.4em;
  font-weight: 800;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
  animation: pulse-question 2.5s infinite;
  letter-spacing: 0.3px;
  line-height: 1.3;
}

@keyframes pulse-question {
  0%, 100% { 
    transform: scale(1);
  }
  50% { 
    transform: scale(1.05);
  }
}

/* ========================
   BOTONES
======================== */

.buttons {
  text-align: center;
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
  padding: 0 10px;
}

button {
  padding: 14px 30px;
  border: none;
  border-radius: 50px;
  font-size: 1.05em;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  position: relative;
  overflow: hidden;
  letter-spacing: 0.3px;
  font-family: inherit;
  white-space: nowrap;
}

button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s ease, height 0.6s ease;
}

button:active::before {
  width: 300px;
  height: 300px;
}

.btn-si {
  background: var(--gradient-primary);
  color: white;
}

.btn-si:hover {
  transform: scale(1.08) rotate(-2deg);
  box-shadow: 0 10px 28px rgba(255,77,109,0.4);
}

.btn-no {
  background: linear-gradient(135deg, #666, #444);
  color: white;
}

.btn-no:hover {
  transform: scale(1.05) rotate(2deg);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

.btn-wa {
  background: linear-gradient(135deg, #25D366, #128C7E);
  color: white;
}

.btn-wa:hover {
  transform: scale(1.06);
  box-shadow: 0 8px 24px rgba(37,211,102,0.4);
}

.btn-mail {
  background: linear-gradient(135deg, #0072c6, #005a9e);
  color: white;
}

.btn-mail:hover {
  transform: scale(1.06);
  box-shadow: 0 8px 24px rgba(0,114,198,0.4);
}

.result {
  display: none;
  text-align: center;
  font-size: 1.4em;
  font-weight: 700;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-top: 25px;
  animation: result-appear 0.8s var(--transition-smooth);
  line-height: 1.4;
  padding: 0 10px;
}

@keyframes result-appear {
  from {
    opacity: 0;
    transform: scale(0) rotate(-180deg);
  }
  to {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
}

.share {
  display: none;
  text-align: center;
  margin-top: 20px;
  animation: fade-in 0.8s ease-out 0.3s both;
}

@keyframes fade-in {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ========================
   CONTROL DE AUDIO
======================== */

.audio-control {
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 1000;
  background: var(--gradient-primary);
  border: none;
  border-radius: 50%;
  width: 65px;
  height: 65px;
  cursor: pointer;
  box-shadow: 0 8px 24px rgba(255,77,109,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8em;
  transition: all 0.3s ease;
  border: 3px solid rgba(255,255,255,0.9);
}

.audio-control:hover {
  transform: scale(1.1);
  box-shadow: 0 12px 32px rgba(255,77,109,0.6);
}

.audio-control:active {
  transform: scale(0.95);
}

.audio-control.playing {
  animation: rotate-music 4s linear infinite;
}

@keyframes rotate-music {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ========================
   RESPONSIVE
======================== */

@media (max-width: 520px) {
  body {
    padding: 15px 10px;
  }
  
  .tap-instruction {
    font-size: 0.95em;
    top: -60px;
  }
  
  .envelope {
    max-width: 100%;
    height: 280px;
  }
  
  .paper {
    padding: 25px 20px;
    height: 88%;
  }
  
  h1 {
    font-size: 1.9em;
  }
  
  .heart-header {
    font-size: 3.5em;
    margin-bottom: 12px;
  }
  
  .poem {
    font-size: 0.95em;
    line-height: 1.7;
  }
  
  .question {
    font-size: 1.25em;
    margin: 20px 0 15px;
  }
  
  button {
    padding: 12px 24px;
    font-size: 0.95em;
  }
  
  .buttons {
    gap: 12px;
  }
  
  .result {
    font-size: 1.2em;
  }
  
  .audio-control {
    width: 55px;
    height: 55px;
    font-size: 1.5em;
    bottom: 20px;
    right: 20px;
  }
  
  .stamp {
    width: 48px;
    height: 48px;
    font-size: 1.5em;
    top: 12px;
    right: 12px;
  }
  
  .ribbon {
    width: 70px;
    height: 70px;
  }
}

@media (max-width: 380px) {
  .envelope {
    height: 260px;
  }
  
  .paper {
    padding: 20px 15px;
  }
  
  h1 {
    font-size: 1.7em;
  }
  
  .heart-header {
    font-size: 3em;
  }
  
  .poem {
    font-size: 0.9em;
  }
  
  .question {
    font-size: 1.15em;
  }
  
  button {
    padding: 11px 20px;
    font-size: 0.9em;
  }
}

/* ========================
   UTILIDADES
======================== */

.hidden {
  display: none !important;
}

.no-select {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
}
</style>
</head>

<body>

<!-- Contenedor de part√≠culas -->
<div class="particles-container" id="particles" aria-hidden="true"></div>

<!-- Estrellas de fondo -->
<div class="stars-background" id="stars" aria-hidden="true"></div>

<!-- Audio de fondo - M√∫ltiples fuentes CDN verificadas -->
<audio id="bgMusic" loop preload="auto">
  <source src="https://cdn.pixabay.com/audio/2022/03/10/audio_4d53875801.mp3" type="audio/mpeg">
  <source src="https://cdn.pixabay.com/audio/2021/08/04/audio_0625c1539c.mp3" type="audio/mpeg">
  <source src="https://cdn.pixabay.com/audio/2022/05/27/audio_1808fbf07a.mp3" type="audio/mpeg">
</audio>

<!-- Control de audio -->
<button class="audio-control" id="audioControl" aria-label="Control de m√∫sica" title="Click para m√∫sica">
  üéµ
</button>

<!-- Contenedor del sobre -->
<div class="envelope-wrapper">
  <div class="tap-instruction no-select" id="tapInstruction">
    üëÜ Toca el sobre para abrir üíå
  </div>
  
  <div class="envelope" id="envelope" role="button" aria-label="Abrir carta de amor" tabindex="0">
    <!-- Sello postal -->
    <div class="stamp">üíï</div>
    
    <!-- Lazo decorativo -->
    <div class="ribbon" aria-hidden="true">
      <div class="ribbon-left"></div>
      <div class="ribbon-right"></div>
      <div class="ribbon-center"></div>
      <div class="ribbon-tail-left"></div>
      <div class="ribbon-tail-right"></div>
    </div>
    
    <!-- Tapa del sobre -->
    <div class="flap" aria-hidden="true"></div>

    <!-- Papel de la carta -->
    <div class="paper" role="article">
      <div class="heart-header" aria-hidden="true">‚ù§Ô∏è</div>
      <h1>Para ti, Yin</h1>
      <div class="divider" aria-hidden="true"></div>

      <p class="poem" id="textoPoema">
        Desde que llegaste a mi vida, algo cambi√≥.<br>
        Los d√≠as se sienten m√°s ligeros,<br>
        las sonrisas m√°s sinceras<br>
        y el coraz√≥n un poco m√°s valiente.<br><br>
        
        Eres la raz√≥n por la que creo en la magia,<br>
        la melod√≠a que llena mis silencios,<br>
        el color en mis d√≠as grises.<br><br>
        
        Cada momento a tu lado es un regalo,<br>
        cada palabra tuya, una melod√≠a,<br>
        cada mirada, un universo nuevo.<br><br>
        
        Hoy, con todo mi coraz√≥n,<br>
        quiero preguntarte algo muy especial.
      </p>

      <div class="divider" aria-hidden="true"></div>

      <div class="question" role="heading" aria-level="2">
        ¬øQuieres ser mi San Valent√≠n? üíñ
      </div>

      <div class="buttons" role="group" aria-label="Opciones de respuesta">
        <button class="btn-si" onclick="responder(true, event)" aria-label="Responder que s√≠">
          ¬°S√≠, quiero! üíò
        </button>
        <button class="btn-no" onclick="responder(false, event)" aria-label="Responder que no">
          No puedo üíî
        </button>
      </div>

      <div class="result" id="resultado" role="alert" aria-live="polite"></div>

      <div class="share" id="compartir">
        <div class="divider" aria-hidden="true"></div>
        <button class="btn-wa" onclick="enviarWhatsApp()" aria-label="Compartir por WhatsApp">
          üì≤ WhatsApp
        </button>
        <button class="btn-mail" onclick="enviarCorreo()" aria-label="Compartir por correo">
          ‚úâÔ∏è Correo
        </button>
      </div>
    </div>
  </div>
</div>

<script>
'use strict';

// ========================
// CONFIGURACI√ìN
// ========================

const CONFIG = {
  phoneNumber: '51930246091',
  email: 'ortizjampier@gmail.com',
  hearts: {
    interval: 400,
    emojis: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó', 'üíù', 'üíì', 'üíû']
  },
  stars: {
    count: 80
  },
  speech: {
    lang: 'es-ES',
    rate: 0.9,
    pitch: 1.1
  }
};

// ========================
// ELEMENTOS DOM
// ========================

const elements = {
  envelope: document.getElementById('envelope'),
  textoPoema: document.getElementById('textoPoema'),
  resultado: document.getElementById('resultado'),
  compartir: document.getElementById('compartir'),
  bgMusic: document.getElementById('bgMusic'),
  audioControl: document.getElementById('audioControl'),
  tapInstruction: document.getElementById('tapInstruction'),
  particles: document.getElementById('particles'),
  stars: document.getElementById('stars'),
  buttons: document.querySelector('.buttons')
};

// ========================
// ESTADO
// ========================

const state = {
  abierta: false,
  musicPlaying: false,
  respuestaFinal: '',
  heartInterval: null
};

// ========================
// EFECTOS VISUALES
// ========================

/**
 * Crea estrellas en el fondo
 */
function createStars() {
  const fragment = document.createDocumentFragment();
  
  for (let i = 0; i < CONFIG.stars.count; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = `${Math.random() * 100}%`;
    star.style.top = `${Math.random() * 100}%`;
    star.style.animationDelay = `${Math.random() * 3}s`;
    fragment.appendChild(star);
  }
  
  elements.stars.appendChild(fragment);
}

/**
 * Crea corazones flotantes
 */
function createFloatingHearts() {
  if (state.heartInterval) {
    clearInterval(state.heartInterval);
  }
  
  state.heartInterval = setInterval(() => {
    const heart = document.createElement('div');
    heart.className = 'floating-heart';
    heart.textContent = CONFIG.hearts.emojis[Math.floor(Math.random() * CONFIG.hearts.emojis.length)];
    heart.style.left = `${Math.random() * 100}%`;
    heart.style.fontSize = `${Math.random() * 15 + 18}px`;
    heart.style.animationDuration = `${Math.random() * 3 + 8}s`;
    heart.style.animationDelay = `${Math.random() * 2}s`;
    
    elements.particles.appendChild(heart);
    
    setTimeout(() => {
      if (heart && heart.parentNode) {
        heart.remove();
      }
    }, 12000);
  }, CONFIG.hearts.interval);
}

/**
 * Crea confetti de corazones
 */
function createHeartConfetti(count = 25) {
  for (let i = 0; i < count; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'floating-heart';
      confetti.textContent = CONFIG.hearts.emojis[Math.floor(Math.random() * CONFIG.hearts.emojis.length)];
      confetti.style.left = `${Math.random() * 100}%`;
      confetti.style.fontSize = `${Math.random() * 25 + 22}px`;
      confetti.style.animationDuration = `${Math.random() * 2 + 4}s`;
      
      elements.particles.appendChild(confetti);
      
      setTimeout(() => {
        if (confetti && confetti.parentNode) {
          confetti.remove();
        }
      }, 7000);
    }, i * 60);
  }
}

// ========================
// FUNCIONES DE AUDIO
// ========================

/**
 * S√≠ntesis de voz
 */
function hablar(mensaje) {
  if (!('speechSynthesis' in window)) return;
  
  try {
    speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(mensaje);
    utterance.lang = CONFIG.speech.lang;
    utterance.rate = CONFIG.speech.rate;
    utterance.pitch = CONFIG.speech.pitch;
    speechSynthesis.speak(utterance);
  } catch (error) {
    console.warn('Speech synthesis no disponible');
  }
}

/**
 * Toggle m√∫sica
 */
function toggleMusic() {
  if (state.musicPlaying) {
    pauseMusic();
  } else {
    playMusic();
  }
}

/**
 * Reproduce m√∫sica
 */
function playMusic() {
  const playPromise = elements.bgMusic.play();
  
  if (playPromise !== undefined) {
    playPromise
      .then(() => {
        state.musicPlaying = true;
        elements.audioControl.textContent = 'üé∂';
        elements.audioControl.classList.add('playing');
        elements.audioControl.title = 'Pausar m√∫sica';
      })
      .catch(error => {
        console.warn('M√∫sica requiere interacci√≥n del usuario');
      });
  }
}

/**
 * Pausa m√∫sica
 */
function pauseMusic() {
  elements.bgMusic.pause();
  state.musicPlaying = false;
  elements.audioControl.textContent = 'üéµ';
  elements.audioControl.classList.remove('playing');
  elements.audioControl.title = 'Reproducir m√∫sica';
}

// ========================
// INTERACCIONES
// ========================

/**
 * Abre el sobre
 */
function abrirSobre() {
  if (state.abierta) return;
  
  state.abierta = true;
  elements.envelope.classList.add('open');
  elements.tapInstruction.classList.add('hidden');
  
  // Reproducir m√∫sica
  setTimeout(() => {
    playMusic();
  }, 600);
  
  // Leer carta
  setTimeout(() => {
    const texto = elements.textoPoema.textContent
      .replace(/<br\s*\/?>/gi, ' ')
      .replace(/\s+/g, ' ')
      .trim();
    hablar(`${texto}. ¬øQuieres ser mi San Valent√≠n?`);
  }, 1200);
  
  // Confetti
  setTimeout(() => {
    createHeartConfetti(20);
  }, 800);
}

/**
 * Procesa respuesta
 */
function responder(aceptado, event) {
  event.stopPropagation();
  
  elements.buttons.style.display = 'none';
  elements.resultado.style.display = 'block';
  elements.compartir.style.display = 'block';
  
  if (aceptado) {
    state.respuestaFinal = 'üíñ ¬°Respondi√≥ S√ç! ¬°Acepto ser tu San Valent√≠n! üíñ';
    elements.resultado.textContent = '¬°Me haces la persona m√°s feliz del mundo! ü•∞‚ú®';
    hablar('¬°S√≠! ¬°Acepto ser tu San Valent√≠n! Me haces muy feliz');
    
    // Explosi√≥n de corazones
    for (let i = 0; i < 50; i++) {
      setTimeout(() => createHeartConfetti(6), i * 100);
    }
  } else {
    state.respuestaFinal = 'üíî Respondi√≥ NO a la propuesta de San Valent√≠n üíî';
    elements.resultado.textContent = 'Entiendo... quiz√°s en otra ocasi√≥n üòîüíô';
    hablar('Entiendo tu respuesta. Gracias por tu sinceridad');
  }
}

/**
 * Env√≠a por WhatsApp
 */
function enviarWhatsApp() {
  const url = `https://wa.me/${CONFIG.phoneNumber}?text=${encodeURIComponent(state.respuestaFinal)}`;
  window.open(url, '_blank', 'noopener,noreferrer');
}

/**
 * Env√≠a por correo
 */
function enviarCorreo() {
  const subject = encodeURIComponent('Respuesta a la carta de San Valent√≠n üíñ');
  const body = encodeURIComponent(state.respuestaFinal);
  window.location.href = `mailto:${CONFIG.email}?subject=${subject}&body=${body}`;
}

// ========================
// EVENT LISTENERS
// ========================

elements.audioControl.addEventListener('click', toggleMusic);
elements.envelope.addEventListener('click', abrirSobre);

elements.envelope.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    abrirSobre();
  }
});

// ========================
// INICIALIZACI√ìN
// ========================

function init() {
  createStars();
  createFloatingHearts();
  elements.bgMusic.load();
  elements.bgMusic.volume = 0.5;
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}

// Cleanup
window.addEventListener('beforeunload', () => {
  if (state.heartInterval) {
    clearInterval(state.heartInterval);
  }
  if (state.musicPlaying) {
    elements.bgMusic.pause();
  }
  speechSynthesis.cancel();
});

</script>

</body>
</html>
